# Trivial comment added to force GitHub to re-register this workflow.
name: Render and Publish Skins Page

on:
  # Schedule based on UTC time
  schedule:
    # --- Daytime Runs (CDT / UTC-5) ---
   # - cron: '0 12 * * *'  #  7:00 AM CDT
    - cron: '0 14 * * *'  #  9:00 AM CDT
    - cron: '0 18 * * *'  #  1:00 PM CDT
    - cron: '0 22 * * *'  #  5:00 PM CDT
    
    # --- Evening Runs (Every 30 mins from 7:00 PM to 1:30 AM CDT) ---
    - cron: '0 23 * * *'   #  6:00 PM CDT (previous day UTC)
    - cron: '30 23 * * *'  #  6:30 PM CDT (previous day UTC)
    - cron: '0 0 * * *'   #  7:00 PM CDT (previous day UTC)
    - cron: '30 0 * * *'  #  7:30 PM CDT (previous day UTC)
    - cron: '0 1 * * *'   #  8:00 PM CDT (previous day UTC)
    - cron: '15 1 * * *'  #  8:15 PM CDT (previous day UTC)
    - cron: '30 1 * * *'  #  8:30 PM CDT (previous day UTC)
    - cron: '0 2 * * *'   #  9:00 PM CDT (previous day UTC)
    - cron: '15 2 * * *'  #  9:15 PM CDT (previous day UTC)
    - cron: '30 2 * * *'  #  9:30 PM CDT (previous day UTC)
    - cron: '45 2 * * *'  #  9:45 PM CDT (previous day UTC)
    - cron: '0 3 * * *'   # 10:00 PM CDT (previous day UTC)
    - cron: '15 3 * * *'  # 10:15 PM CDT (previous day UTC)
    - cron: '30 3 * * *'  # 10:30 PM CDT (previous day UTC)
    - cron: '55 3 * * *'   # 10:55 PM CDT (previous day UTC)
    - cron: '15 4 * * *'  # 11:15 PM CDT (previous day UTC)
    - cron: '30 4 * * *'  # 11:30 PM CDT (previous day UTC)
    - cron: '0 5 * * *'   # 12:00 AM CDT
    - cron: '30 5 * * *'  # 12:30 AM CDT
    - cron: '0 6 * * *'   #  1:00 AM CDT
  #  - cron: '30 6 * * *'  #  1:30 AM CDT

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# Set permissions for the job
permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 
      
      - name: Install system dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            libcurl4-openssl-dev \
            libxml2-dev \
            libssl-dev \
            libfontconfig1-dev \
            libfreetype6-dev \
            libfribidi-dev \
            libharfbuzz-dev \
            libpng-dev
      
      - name: Set up R
        uses: r-lib/actions/setup-r@v2
        with:
          r-version: 'latest'
      
      - name: Set up Quarto
        uses: quarto-dev/quarto-actions/setup@v2
      
      - name: Install R Dependencies
        run: |
          R -e "install.packages('pacman', dependencies = TRUE)"
          R -e "pacman::p_load(rvest, httr, dplyr, tidyr, stringr, lubridate, tibble, knitr, kableExtra, readr, ggplot2)"
      
      - name: Create history directory
        run: |
          mkdir -p skins_history
      
      - name: Render Quarto Document
        run: |
          quarto render skins_today.qmd --to html --output-dir _site --output index.html
      
      - name: Commit history updates
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add skins_history/*.csv
          git diff --staged --quiet || git commit -m "Update skins history - $(date +'%Y-%m-%d')"
          git push
        continue-on-error: true 
      
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: './_site'
      
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4

